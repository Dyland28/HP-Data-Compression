DROP TABLE CAPSTONE.T1_REF;
TRUNCATE TABLE CAPSTONE.T1_REF;
CREATE TABLE CAPSTONE.T1_REF
(
VARCHAR_KEY NUMBER,
VARCHAR_1 VARCHAR2(1),
VARCHAR_2 VARCHAR2(2),
VARCHAR_4 VARCHAR2(4),
VARCHAR_8 VARCHAR2(8),
VARCHAR_16 VARCHAR2(16),
VARCHAR_32 VARCHAR2(32),
VARCHAR_64 VARCHAR2(64)
)
NOLOGGING
NOCOMPRESS
TABLESPACE CAP8K;

BEGIN

FOR A IN 0..63 LOOP

INSERT INTO CAPSTONE.T1_REF

SELECT
    A,
    RPAD(NCHR(33+A),1,NCHR(33+A)) AS VARCHAR_1,
    RPAD(NCHR(33+A),2,NCHR(33+A)) AS VARCHAR_2,
    RPAD(NCHR(33+A),4,NCHR(33+A)) AS VARCHAR_4,
    RPAD(NCHR(33+A),8,NCHR(33+A)) AS VARCHAR_8,
    RPAD(NCHR(33+A),16,NCHR(33+A)) AS VARCHAR_16,
    RPAD(NCHR(33+A),32,NCHR(33+A)) AS VARCHAR_32,
    RPAD(NCHR(33+A),64,NCHR(33+A)) AS VARCHAR_64
FROM DUAL;

END LOOP;
COMMIT;
END;
/

WITH TABLE_NAME_DEKEY AS

(
SELECT
   A.TABLE_TYPE || '_' || B.DESCRIPTION || '_' || D.DESCRIPTION || '_' || E.DESCRIPTION || '_' || C.DESCRIPTION AS TABLE_NAME,
   A.TABLE_TYPE,
   B.DESCRIPTION AS BLOCK_SIZE,
   D.VARCHAR_LENGTH,
   E.BLOCK_CARDINALITY,
   C.DESCRIPTION AS COMPRESSION_TYPE
FROM CAPSTONE.TABLE_TYPES A
    CROSS JOIN CAPSTONE.TABLESPACE_TYPES B
    CROSS JOIN CAPSTONE.COMPRESSION_TYPES C
    CROSS JOIN CAPSTONE.VARCHAR_LENGTH D
    CROSS JOIN CAPSTONE.BLOCK_CARDINALITY E
WHERE C.OBJECT_TYPE = 'TABLE'
)

SELECT
    A.COMPRESS_FOR,
    A.OWNER,
    A.TABLE_NAME,
    A.TABLESPACE_NAME,
    A.INITIAL_EXTENT,
    A.NEXT_EXTENT,
    A.NUM_ROWS,
    A.BLOCKS,
    B.BLOCK_SIZE * A.BLOCKS / POWER(1024,2) AS TABLE_SIZE_MB,
    C.TABLE_TYPE,
    C.BLOCK_SIZE,
    C.VARCHAR_LENGTH,
    C.BLOCK_CARDINALITY,
    C.COMPRESSION_TYPE
FROM DBA_TABLES A
    INNER JOIN DBA_TABLESPACES B
        ON A.TABLESPACE_NAME = B.TABLESPACE_NAME
    INNER JOIN TABLE_NAME_DEKEY C
        ON A.TABLE_NAME = C.TABLE_NAME
WHERE B.TABLESPACE_NAME IN ('CAP8K','CAP16K','CAP32K')
--AND A.TABLE_NAME LIKE '%NORM_%_L32_BC32/_%' ESCAPE '/'
AND A.TABLE_NAME <> 'T1_REF'
ORDER BY
    TABLE_SIZE_MB,
    TABLE_NAME;

SELECT
    'DROP TABLE ' || OWNER || '.' || TABLE_NAME || ';' AS DROP_TABLE_STATEMENT
FROM DBA_TABLES A
    INNER JOIN DBA_TABLESPACES B
        ON A.TABLESPACE_NAME = B.TABLESPACE_NAME
WHERE B.TABLESPACE_NAME IN ('CAP8K','CAP16K','CAP32K')
AND A.TABLE_NAME <> 'T1_REF';

DROP TABLE CAPSTONE.SIZE_MATH_TEST;
CREATE TABLE CAPSTONE.SIZE_MATH_TEST
NOCOMPRESS
PCTFREE 0

AS

SELECT /*+ NOPARALLEL */
    'AAAAAAAA' AS COL1 
FROM DUAL
CONNECT BY LEVEL <= 2000;

SELECT * FROM CAPSTONE.SIZE_MATH_TEST;

SELECT
    A.OWNER,
    A.TABLE_NAME,
    A.TABLESPACE_NAME,
    A.PCT_FREE,
    A.NUM_ROWS,
    A.AVG_ROW_LEN,
    A.BLOCKS,
    B.BLOCK_SIZE,
    A.NUM_ROWS/A.BLOCKS AS ROWS_PER_BLOCK
FROM DBA_TABLES A
    INNER JOIN DBA_TABLESPACES B
        ON A.TABLESPACE_NAME = B.TABLESPACE_NAME
WHERE TABLE_NAME = 'SIZE_MATH_TEST';

SELECT 
    OWNER,
    TABLE_NAME,
    COLUMN_NAME,
    DATA_LENGTH,
    NUM_DISTINCT
FROM ALL_TAB_COLS
WHERE TABLE_NAME = 'SIZE_MATH_TEST';